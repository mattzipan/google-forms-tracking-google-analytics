<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Forms Tracking with Google Analytics - Proof of concept</title>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-9WQ7FQ7ZGQ"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-9WQ7FQ7ZGQ');
    </script>
</head>

<body>

    <iframe
        src="https://docs.google.com/forms/d/e/1FAIpQLSffBTD6UF5Weh1hDNHd4QSxlg4da0jxTTml666EKTn37xR1Qg/viewform?usp=pp_url&entry.1796799655=sdflkhjasdflkjhl&entry.1038416998=sdafkjhsdlkhjajk&embedded=true"
        width="640" height="884" frameborder="0" marginheight="0" marginwidth="0">
        Loadingâ€¦
    </iframe>
    <script>
        //replace iframe source with user data values
        var googleForm = window.document.querySelector('iframe[src*="google.com/forms/"]');
        var googleFormSrc = googleForm.getAttribute('src')
        var getGaClientID = function () {
            const gaCookie = document.cookie.split(';').find(cookie => cookie.includes('_ga='));
            if (gaCookie) {
                const gaValue = gaCookie.split('=')[1];
                const gaParts = gaValue.split('.');
                if (gaParts.length >= 3) {
                    return gaParts.slice(2).join('.');
                }
            }

            return null;
        }
        var googleFormClientId = getGaClientID();
        var getGaSessionId = function () {
            // Get the cookie value
            var cookieValue = document.cookie
                .split('; ')
                .find(row => row.startsWith('_ga_'))
                .split('=')[1];

            // Extract the value between the 2nd and 3rd period (.)
            if (cookieValue) {
                var value = cookieValue.split('.')[2];
                // Return the extracted value
                return value;
            }

            return null;

        }
        var googleFormSessionId = getGaSessionId()
        var t = 0;
        var result = googleFormSrc.replace(/(?<=entry\.\d+=)([^&]+)/g, function (match) {
            t = t + 1;
            return t === 2 ? googleFormSessionId : googleFormClientId;
        });
        // inject new src into iframe
        googleForm.setAttribute('src', result)
    </script>
</body>

</html>